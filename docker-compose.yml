version: '3.8'

services:
  # ðŸŽï¸ THE CHASSIS - Core Trading Engine
  bot:
    # En producciÃ³n: usa imagen pre-compilada desde GHCR (ghcr.io/higrub89/the_chassis:latest)
    # En local: construye desde el Dockerfile -> docker compose build bot
    image: ${BOT_IMAGE:-ghcr.io/higrub89/the_chassis:latest}
    container_name: solana_trading_bot
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - RUST_LOG=info
      - TZ=UTC
    volumes:
      # Persistencia de logs
      - ./logs:/app/logs
      # Config dinÃ¡mica â€” edita targets.json y reinicia para aplicar cambios
      - ./targets.json:/app/targets.json
      # Base de datos de estado persistente (posiciones, historial, PnL)
      - ./trading_state.db:/app/trading_state.db
      # Cache de pools de Raydium
      - ./pools_cache.json:/app/pools_cache.json
    deploy:
      resources:
        limits:
          cpus: '1.50'
          memory: 2048M
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    healthcheck:
      test: ["CMD-SHELL", "pidof the_chassis_app || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

