syntax = "proto3";

package geyser;

service Geyser {
    rpc Subscribe (stream SubscribeRequest) returns (stream SubscribeUpdate);
    rpc Ping (PingRequest) returns (PingResponse);
}

message SubscribeRequest {
    map<string, SubscribeRequestFilterAccounts> accounts = 1;
    map<string, SubscribeRequestFilterSlots> slots = 2;
    map<string, SubscribeRequestFilterTransactions> transactions = 3;
    map<string, SubscribeRequestFilterBlocks> blocks = 4;
    map<string, SubscribeRequestFilterBlocksMeta> blocks_meta = 5;
    optional SubscribeRequestFilterEntry entry = 6;
    optional CommitmentLevel commitment = 7;
    map<string, SubscribeRequestFilterAccountsDataSlice> accounts_data_slice = 8;
    optional uint64 ping = 9;
}

message SubscribeRequestFilterAccounts {
    repeated string account = 1;
    repeated string owner = 2;
    repeated SubscribeRequestFilterAccountsFilter filters = 3;
}

message SubscribeRequestFilterAccountsFilter {
    oneof filter {
        SubscribeRequestFilterAccountsFilterMemcmp memcmp = 1;
        uint64 data_size = 2;
    }
}

message SubscribeRequestFilterAccountsFilterMemcmp {
    uint64 offset = 1;
    oneof bytes {
        string base58 = 2;
        bytes raw = 3;
    }
}

message SubscribeRequestFilterAccountsDataSlice {
    uint64 offset = 1;
    uint64 length = 2;
}

message SubscribeRequestFilterSlots {
    optional bool filter_by_commitment = 1;
}

message SubscribeRequestFilterTransactions {
    optional bool vote = 1;
    optional bool failed = 2;
    optional string signature = 3;
    repeated string account_include = 4;
    repeated string account_exclude = 5;
    repeated string account_required = 6;
}

message SubscribeRequestFilterBlocks {
}

message SubscribeRequestFilterBlocksMeta {
}

message SubscribeRequestFilterEntry {
}

enum CommitmentLevel {
    PROCESSED = 0;
    CONFIRMED = 1;
    FINALIZED = 2;
}

message SubscribeUpdate {
    oneof update_oneof {
        SubscribeUpdateAccount account = 1;
        SubscribeUpdateSlot slot = 2;
        SubscribeUpdateTransaction transaction = 3;
        SubscribeUpdateBlock block = 4;
        SubscribeUpdatePing ping = 5;
        SubscribeUpdateBlockMeta block_meta = 6;
        SubscribeUpdateEntry entry = 7;
    }
    repeated string filters = 8;
}

message SubscribeUpdateAccount {
    SubscribeUpdateAccountInfo account = 1;
    uint64 slot = 2;
    bool is_startup = 3;
}

message SubscribeUpdateAccountInfo {
    bytes pubkey = 1;
    uint64 lamports = 2;
    bytes owner = 3;
    bool executable = 4;
    uint64 rent_epoch = 5;
    bytes data = 6;
    uint64 write_version = 7;
}

message SubscribeUpdateSlot {
    uint64 slot = 1;
    optional uint64 parent = 2;
    CommitmentLevel status = 3;
}

message SubscribeUpdateTransaction {
    SubscribeUpdateTransactionInfo transaction = 1;
    uint64 slot = 2;
}

message SubscribeUpdateTransactionInfo {
    bytes signature = 1;
    bool is_vote = 2;
    // Simplified transaction info
}

message SubscribeUpdateBlock {
    // Simplified block info
}

message SubscribeUpdateBlockMeta {
}

message SubscribeUpdateEntry {
}

message SubscribeUpdatePing {
}

message PingRequest {
    int32 count = 1;
}

message PingResponse {
    int32 count = 1;
}
